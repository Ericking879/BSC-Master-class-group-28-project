const getWeb3 = () => {
    return new Promise((resolve, reject) => {
      window.addEventListener("load", async () => {        
        if (window.ethereum) {
          const web3 = new Web3(window.ethereum);
          try {
            // ask user permission to access his accounts
            await window.ethereum.request({ method: "eth_requestAccounts" });
            resolve(web3);
          } catch (error) {
            reject(error);
          }
        } else {
          reject("Must install MetaMask");
          do_not_have_metamask();
        }
      });
    });
  };

const getContract = async (web3) => {
    // const data = await $.getJSON("contracts/CryptoInsure.json");
    // const netId = await web3.eth.net.getId();
    // const deployedNetwork = data.networks[netId];
    // const newContract = new web3.eth.Contract(
    //   data.abi,
    //   deployedNetwork && deployedNetwork.address
    // );

    //const abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"cancelPolicy","outputs":[{"internalType":"bool","name":"cancelled","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newAddress","type":"address"}],"name":"changeAddress","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getLatestBNBPrice","outputs":[{"internalType":"int256","name":"","type":"int256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"getNextInstallmentDate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"hasPolicyMatured","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"makeClaim","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"ownerCancelPolicy","outputs":[{"internalType":"bool","name":"cancelled","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"payInstallment","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amntToInsure","type":"uint256"},{"internalType":"uint256","name":"termInMonths","type":"uint256"}],"name":"registerPolicy","outputs":[{"internalType":"bool","name":"registered","type":"bool"}],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"retrievePolicyDetails","outputs":[{"internalType":"uint256","name":"balance","type":"uint256"},{"internalType":"uint256","name":"totalRepayment","type":"uint256"},{"internalType":"uint256","name":"noOfInstallments","type":"uint256"},{"internalType":"uint256","name":"installmentAmount","type":"uint256"},{"internalType":"uint256","name":"waitingPeriod","type":"uint256"},{"internalType":"bool","name":"isInArrears","type":"bool"},{"internalType":"uint256","name":"startDate","type":"uint256"},{"internalType":"uint256","name":"endDate","type":"uint256"},{"internalType":"bool","name":"pendingFirstInstallment","type":"bool"},{"internalType":"bool","name":"isBalanceToppedUp","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"withdraw","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}];
    //const address = "0xEe1FF6EE8a0B93D9e7E6529ba9110eFd09F16975";

    //const abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"cancelPolicy","outputs":[{"internalType":"bool","name":"cancelled","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newAddress","type":"address"}],"name":"changeAddress","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getLatestBNBPrice","outputs":[{"internalType":"int256","name":"","type":"int256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"getNextInstallmentDate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"hasPolicyMatured","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"makeClaim","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"ownerCancelPolicy","outputs":[{"internalType":"bool","name":"cancelled","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"payInstallment","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amntToInsure","type":"uint256"},{"internalType":"uint256","name":"termInMonths","type":"uint256"}],"name":"registerPolicy","outputs":[{"internalType":"bool","name":"registered","type":"bool"}],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"retrievePolicyDetails","outputs":[{"internalType":"uint256","name":"balance","type":"uint256"},{"internalType":"int256","name":"bnbPriceAtStart","type":"int256"},{"internalType":"uint256","name":"totalRepayment","type":"uint256"},{"internalType":"uint256","name":"noOfInstallments","type":"uint256"},{"internalType":"uint256","name":"installmentAmount","type":"uint256"},{"internalType":"uint256","name":"waitingPeriod","type":"uint256"},{"internalType":"bool","name":"isInArrears","type":"bool"},{"internalType":"uint256","name":"startDate","type":"uint256"},{"internalType":"uint256","name":"endDate","type":"uint256"},{"internalType":"bool","name":"pendingFirstInstallment","type":"bool"},{"internalType":"bool","name":"isBalanceToppedUp","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"withdraw","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}];
    //const address = "0x266318aecf3Df050caA3220b336f7d0C76bAb61a";

    const abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"cancelPolicy","outputs":[{"internalType":"bool","name":"cancelled","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newAddress","type":"address"}],"name":"changeAddress","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getLatestBNBPrice","outputs":[{"internalType":"int256","name":"","type":"int256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"getNextInstallmentDate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"hasPolicyMatured","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"makeClaim","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"ownerCancelPolicy","outputs":[{"internalType":"bool","name":"cancelled","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"payInstallment","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amntToInsure","type":"uint256"},{"internalType":"uint256","name":"termInMonths","type":"uint256"}],"name":"registerPolicy","outputs":[{"internalType":"bool","name":"registered","type":"bool"}],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"clientAddress","type":"address"}],"name":"retrievePolicyDetails","outputs":[{"components":[{"internalType":"uint256","name":"balance","type":"uint256"},{"internalType":"int256","name":"bnbPriceAtStart","type":"int256"},{"internalType":"uint256","name":"totalRepayment","type":"uint256"},{"internalType":"uint256","name":"noOfInstallments","type":"uint256"},{"internalType":"uint256","name":"installmentAmount","type":"uint256"},{"internalType":"uint256","name":"waitingPeriod","type":"uint256"},{"internalType":"bool","name":"isInArrears","type":"bool"},{"internalType":"uint256","name":"startDate","type":"uint256"},{"internalType":"uint256","name":"endDate","type":"uint256"},{"internalType":"bool","name":"pendingFirstInstallment","type":"bool"},{"internalType":"bool","name":"isBalanceToppedUp","type":"bool"}],"internalType":"struct CryptoInsure.PolicyOutput","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"withdraw","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}];
    const address = "0xb7f1c4b9E1347c75De56c6A2267578315A68dd20";

    const newContract = new web3.eth.Contract(abi, address);

    return newContract;
};

function do_not_have_metamask() {
  if (window.matchMedia("only screen and (min-width: 700px)").matches) {
    document.getElementById("no-have-metamask").className = "not-have-metamask";
  }
  else {
    document.getElementById("no-have-metamask").className = "get-metamask";
  }
}